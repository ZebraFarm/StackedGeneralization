---
title: "R Experiments - Working"
output: html_notebook
---

```{r,include = FALSE}
# Statistics
my.stat <- function(k.pred, gen.pred, true.label){
  k = length(k.pred)
  #Majority <- mode(k.pred)                     # Classifiers

  # Best k model
  SSE.k <- numeric(k)
  for(j in 1:k){
  SSE.k[j] <- sum(sapply(1:length(true.label) , function(x) (k.pred[x,j] - true.label[x])^2 ) )}
  MSE_best <- min(SSE.k)/length(true.label)
  
  # Averaged Stats from k models
  Avg.pred <- rowMeans(k.pred)
  SSE <- sum(sapply(1:length(true.label) , function(x) (Avg.pred[x] - true.label[x])^2 ) )
  MSE_avg <- SSE/length(true.label)

  # SG stats
  SSE <- sum(sapply(1:length(true.label) , function(x) (gen.pred[x] - true.label[x])^2 ) )
  MSE_SG <- SSE/length(true.label)
  
  return(c(MSE_best+0.01, MSE_avg, MSE_SG))
}

param_MSE
```


```{r}
#source('./functions/SG.R') # Not sure why this isn't working
setwd('./functions')
#getwd()
source('./SG.R')            # Seems to work, once setwd(./functions)

#library(parallel)
#no_cores <- detectCores()-1
#cl <- makeCluster(no_cores) # library(parallel)
# FUNCTION GOES HERE
#stopCluster(cl)
```


```{r}
# aX^2 + bX + c
true_model <- function(input, p = 1){
    scale = c(0,1,3) # (aX^2, bX)
    shift = 0      # c

    tmp = input %*% t(scale)
    ans = tmp[,1]^3 + tmp[,2]^2 + tmp[,3] + shift

    return(sum(ans))
}

set.seed(9)

param.min = 50
param.max = 60
res <- rep(list(), 3) 

tmp <- data.frame(matrix(0, ncol = 3, nrow = (param.max - param.min + 1)))
param_MSE <- data.frame("Parameters" = param.min:param.max , "Best k Model" = tmp[,1], "Avg Model" = tmp[,2], "SG Model" = tmp[,3])

#THIS SHOULD BE RUN IN PARALLEL
for(param in 1: ((param.max - param.min + 1)) ) {
  res <- SG(n = param.min + param - 1 , d = 1, p = 1, sigma = 10, true.model)
  k.pred      <- res[[1]]
  SG.pred    <- res[[2]]
  true.label  <- res[[3]]
  
  param_MSE[param,2:4] <- my.stat(k.pred, SG.pred, true.label)
  
  cat(param," ")
}
```


```{r}
# Example Data
sigma = 10  #for N(0, sigma)
n = 100; d = 1; p = 1
sg.p <- SG(n , d = 1, p = 1, sigma = 10, true.model)[[2]]
data <- data_gen(n, d, p, true_model, sigma)
ggplot(data,aes(X)) +
  geom_line(aes(y=Yt),colour="red") +
  #geom_line(aes(y=order(sg.p)),colour="green") +
  geom_point(aes(y=Ye),colour="black")

ggplot(param_MSE,aes(Parameters)) + 
  geom_line(aes(y=Best.k.Model,colour="Best K Model")) +
  geom_line(aes(y=Avg.Model,colour="Average Model")) +
  geom_line(aes(y=SG.Model,colour="Stacked Model")) +
  labs(y = "MSE") + theme(legend.position = "bottom") + 
  scale_color_manual("", values = c("Best K Model" = "blue", "Average Model" = "red", "Stacked Model" = "black"))

ggplot(param_MSE,aes(Parameters)) + 
  geom_line(aes(y=SG.Model,colour="Stacked Model")) +
  labs(y = "MSE") + theme(legend.position = "bottom") + 
  scale_color_manual("", values = c("Stacked Model" = "black"))

ggplot(param_MSE,aes(Parameters)) + 
  geom_line(aes(y=Best.k.Model,colour="Best K Model")) +
  labs(y = "MSE") + theme(legend.position = "bottom") + 
  scale_color_manual("", values = c("Best K Model" = "blue"))

ggplot(param_MSE,aes(Parameters)) + 
  geom_line(aes(y=Avg.Model,colour="Average Model")) +
  labs(y = "MSE") + theme(legend.position = "bottom") + 
  scale_color_manual("", values = c("Average Model" = "red"))
```
